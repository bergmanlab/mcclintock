rule telocate:
    params:
        url = config['URLs']['te-locate'],
        md5 = config['MD5s']['te-locate'],
        tar = config['paths']['install']+"tools/te-locate/te-locate.tar",
        log = config['paths']['log_dir']+"install.log"

    output:
        config['paths']['install']+"tools/te-locate/TE_locate.pl",
        config['paths']['install']+"tools/te-locate/TE_hierarchy.pl"
    
    conda: config['ENVs']['te-locate']

    script:
        config['paths']['install']+"scripts/te-locate.py"


rule retroseq:
    params:
        url = config['URLs']['retroseq'],
        md5 = config['MD5s']['retroseq'],
        zipfile = config['paths']['install']+"tools/retroseq/retroseq.zip",
        log = config['paths']['log_dir']+"install.log"

    output:
        config['paths']['install']+"tools/retroseq/bin/retroseq.pl"
    
    conda: config['ENVs']['retroseq']

    script:
        config['paths']['install']+"scripts/retroseq.py"

rule temp:
    params:
        url = config['URLs']['temp'],
        md5 = config['MD5s']['temp'],
        zipfile = config['paths']['install']+"tools/temp/temp.zip",
        log = config['paths']['log_dir']+"install.log",
        patch = config['paths']['install']+"patches/temp/TEMP_Absence.patch"

    output:
        config['paths']['install']+"tools/temp/scripts/TEMP_Insertion.sh",
        config['paths']['install']+"tools/temp/scripts/TEMP_Absence.sh"
    
    conda: config['ENVs']['temp']

    script:
        config['paths']['install']+"scripts/temp.py"

rule relocate:
    params:
        url = config['URLs']['relocate'],
        md5 = config['MD5s']['relocate'],
        zipfile = config['paths']['install']+"tools/relocate/relocate.zip",
        log = config['paths']['log_dir']+"install.log",
        patch = config['paths']['install']+"patches/relocate/relocaTE_insertionFinder.patch"
    
    output:
        config['paths']['install']+"tools/relocate/scripts/relocaTE_insertionFinder.pl"

    conda: config['ENVs']['relocate']

    script:
       config['paths']['install']+"scripts/relocate.py" 

rule relocate2:
    conda: config['ENVs']['relocate2']

    output:
        config['paths']['install']+"tools/relocate2/relocaTE2.log"
    
    shell:
        "echo 'RelocaTE2 env installed' > {output}"

rule ngs_te_mapper:
    params:
        url = config['URLs']['ngs_te_mapper'],
        md5 = config['MD5s']['ngs_te_mapper'],
        zipfile = config['paths']['install']+"tools/ngs_te_mapper/ngs_te_mapper.zip",
        log = config['paths']['log_dir']+"install.log"
    
    output:
        config['paths']['install']+"tools/ngs_te_mapper/sourceCode/run_ngs_te_mapper.sh"
    
    conda: config['ENVs']['ngs_te_mapper']

    script:
        config['paths']['install']+"scripts/ngs_te_mapper.py"
    
rule popoolationte:
    params:
        url = config['URLs']['popoolationte'],
        md5 = config['MD5s']['popoolationte'],
        zipfile = config['paths']['install']+"tools/popoolationte.zip",
        log = config['paths']['log_dir']+"install.log",
        patch1 = config['paths']['install']+"patches/popoolationte/TEInsertUtility.patch",
        patch2 = config['paths']['install']+"patches/popoolationte/TEInsert.patch",
        patch3 = config['paths']['install']+"patches/popoolationte/samro.patch",
        patch4 = config['paths']['install']+"patches/popoolationte/identify-te-insertsites.patch"
    
    output:
        config['paths']['install']+"tools/popoolationte/Modules/TEInsertUtility.pm",
        config['paths']['install']+"tools/popoolationte/Modules/TEInsert.pm",
        config['paths']['install']+"tools/popoolationte/samro.pl",
        config['paths']['install']+"tools/popoolationte/identify-te-insertsites.pl"
    
    conda: config['ENVs']['popoolationte']

    script:
        config['paths']['install']+"scripts/popoolationte.py"

rule popoolationte2:
    params:
        url = config['URLs']['popoolationte2'],
        md5 = config['MD5s']['popoolationte2'],
        log = config['paths']['log_dir']+"install.log"

    conda: config['ENVs']['popoolationte2']

    output:
        config['paths']['install']+"tools/popoolationte2/popte2-v1.10.03.jar"

    script:
        config['paths']['install']+"scripts/popoolationte2.py"

rule coverage:
    output:
        config['paths']['install']+"tools/coverage/coverage.log"    

    conda: config['ENVs']['coverage']

    shell:
        "echo 'coverage env installed' > {output}"

rule install_all:
    input:
        config['paths']['install']+"tools/te-locate/TE_locate.pl",
        config['paths']['install']+"tools/te-locate/TE_hierarchy.pl",
        config['paths']['install']+"tools/retroseq/bin/retroseq.pl",
        config['paths']['install']+"tools/temp/scripts/TEMP_Insertion.sh",
        config['paths']['install']+"tools/temp/scripts/TEMP_Absence.sh",
        config['paths']['install']+"tools/relocate/scripts/relocaTE_insertionFinder.pl",
        config['paths']['install']+"tools/ngs_te_mapper/sourceCode/run_ngs_te_mapper.sh",
        config['paths']['install']+"tools/popoolationte/Modules/TEInsertUtility.pm",
        config['paths']['install']+"tools/popoolationte/Modules/TEInsert.pm",
        config['paths']['install']+"tools/popoolationte/samro.pl",
        config['paths']['install']+"tools/popoolationte/identify-te-insertsites.pl",
        config['paths']['install']+"tools/popoolationte2/popte2-v1.10.03.jar",
        config['paths']['install']+"tools/coverage/coverage.log",
        config['paths']['install']+"tools/relocate2/relocaTE2.log"
    
    conda: config['ENVs']['mcc_processing']

    shell:
        "echo 'install done!'"
